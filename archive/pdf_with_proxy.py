import os

# ====================================================================
# –ù–ê–°–¢–†–û–ô–ö–ê –ü–†–û–ö–°–ò-–°–ï–†–í–ï–†–ê
# ====================================================================
# –í–ê–ñ–ù–û: –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–æ–∫—Å–∏ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã –î–û –∏–º–ø–æ—Ä—Ç–∞ Docling
# –ó–∞–º–µ–Ω–∏—Ç–µ –Ω–∞ –≤–∞—à–∏ –¥–∞–Ω–Ω—ã–µ –ø—Ä–æ–∫—Å–∏-—Å–µ—Ä–≤–µ—Ä–∞
# ====================================================================

# –í–∞—à–∏ –¥–∞–Ω–Ω—ã–µ –ø—Ä–æ–∫—Å–∏ (–ó–ê–ú–ï–ù–ò–¢–ï –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã–µ!)
PROXY_HOST = "168.80.203.70"       # IP –∏–ª–∏ –¥–æ–º–µ–Ω –ø—Ä–æ–∫—Å–∏
PROXY_PORT = "8000"                # –ü–æ—Ä—Ç –ø—Ä–æ–∫—Å–∏
PROXY_USER = "9u4bcR"               # –õ–æ–≥–∏–Ω (–∑–∞–º–µ–Ω–∏—Ç–µ!)
PROXY_PASS = "gBdhq7"                # –ü–∞—Ä–æ–ª—å (–∑–∞–º–µ–Ω–∏—Ç–µ!)

# –§–æ—Ä–º–∏—Ä—É–µ–º URL –ø—Ä–æ–∫—Å–∏ —Å –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–µ–π
# –§–æ—Ä–º–∞—Ç: http://username:password@host:port
proxy_url = f"http://{PROXY_USER}:{PROXY_PASS}@{PROXY_HOST}:{PROXY_PORT}"

# –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –¥–ª—è HTTP –∏ HTTPS
os.environ['HTTP_PROXY'] = proxy_url
os.environ['HTTPS_PROXY'] = proxy_url
os.environ['http_proxy'] = proxy_url   # –î—É–±–ª–∏—Ä—É–µ–º —Å –º–∞–ª–µ–Ω—å–∫–æ–π –±—É–∫–≤—ã
os.environ['https_proxy'] = proxy_url  # –ù–µ–∫–æ—Ç–æ—Ä—ã–µ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ —á–∏—Ç–∞—é—Ç —Å –º–∞–ª–µ–Ω—å–∫–æ–π

# –î–ª—è requests –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è HuggingFace Hub)
os.environ['REQUESTS_CA_BUNDLE'] = ''  # –û—Ç–∫–ª—é—á–∞–µ–º –ø—Ä–æ–≤–µ—Ä–∫—É SSL –µ—Å–ª–∏ –Ω—É–∂–Ω–æ

# –í—ã–≤–æ–¥–∏–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –ø—Ä–æ–∫—Å–∏ (–ë–ï–ó –ø–∞—Ä–æ–ª—è –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏)
print(f"üåê –ü—Ä–æ–∫—Å–∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω: {PROXY_HOST}:{PROXY_PORT}")
print(f"üë§ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: {PROXY_USER}")
print()

# ====================================================================
# –ò–ú–ü–û–†–¢–ò–†–£–ï–ú DOCLING –ü–û–°–õ–ï –ù–ê–°–¢–†–û–ô–ö–ò –ü–†–û–ö–°–ò!
# ====================================================================

from docling.document_converter import DocumentConverter

# ====================================================================
# –ö–û–ù–í–ï–†–¢–ê–¶–ò–Ø PDF –ß–ï–†–ï–ó –ü–†–û–ö–°–ò
# ====================================================================

# –ü—É—Ç—å –∫ –≤–∞—à–µ–º—É PDF —Ñ–∞–π–ª—É
source = "test.pdf"

print(f"üîÑ –ù–∞—á–∏–Ω–∞–µ–º –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—é PDF —á–µ—Ä–µ–∑ –ø—Ä–æ–∫—Å–∏: {source}")
print("‚è≥ –ü—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—É—Å–∫–µ –∑–∞–≥—Ä—É–∑—è—Ç—Å—è –º–æ–¥–µ–ª–∏ (~700MB)")
print("   –≠—Ç–æ –∑–∞–π–º—ë—Ç 5-15 –º–∏–Ω—É—Ç –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Å–∫–æ—Ä–æ—Å—Ç–∏ –ø—Ä–æ–∫—Å–∏")
print()

try:
    # –°–æ–∑–¥–∞—ë–º –∫–æ–Ω–≤–µ—Ä—Ç–µ—Ä (–∑–∞–≥—Ä—É–∑–∏—Ç –º–æ–¥–µ–ª–∏ —á–µ—Ä–µ–∑ –ø—Ä–æ–∫—Å–∏)
    converter = DocumentConverter()
    
    # –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ–º –¥–æ–∫—É–º–µ–Ω—Ç
    result = converter.convert(source)
    doc = result.document
    
    # –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç
    output_file = "output_with_proxy.md"
    with open(output_file, "w", encoding="utf-8") as f:
        f.write(doc.export_to_markdown())
    
    print()
    print("=" * 60)
    print("‚úÖ –£–°–ü–ï–•! PDF –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä–æ–≤–∞–Ω —á–µ—Ä–µ–∑ –ø—Ä–æ–∫—Å–∏!")
    print("=" * 60)
    print(f"üìÑ –†–µ–∑—É–ª—å—Ç–∞—Ç —Å–æ—Ö—Ä–∞–Ω—ë–Ω: {output_file}")
    print(f"üìä –û–±—Ä–∞–±–æ—Ç–∞–Ω–æ —Å—Ç—Ä–∞–Ω–∏—Ü: {len(doc.pages)}")
    print()
    print("=== –ü–ï–†–í–´–ï 1000 –°–ò–ú–í–û–õ–û–í ===")
    markdown = doc.export_to_markdown()
    print(markdown[:1000])
    print("...")
    
except Exception as e:
    print()
    print("=" * 60)
    print(f"‚ùå –û–®–ò–ë–ö–ê: {e}")
    print("=" * 60)
    print()
    print("üí° –í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã:")
    print("   1. –ù–µ–≤–µ—Ä–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –ø—Ä–æ–∫—Å–∏ (–ø—Ä–æ–≤–µ—Ä—å—Ç–µ login/pass)")
    print("   2. –ü—Ä–æ–∫—Å–∏-—Å–µ—Ä–≤–µ—Ä –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω")
    print("   3. –ü—Ä–æ–∫—Å–∏ –±–ª–æ–∫–∏—Ä—É–µ—Ç –¥–æ—Å—Ç—É–ø –∫ huggingface.co")
    print("   4. –¢—Ä–µ–±—É–µ—Ç—Å—è –æ—Ç–∫–ª—é—á–µ–Ω–∏–µ SSL (—Å–º. –∫–æ–¥)")
